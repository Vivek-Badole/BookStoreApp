{"version":3,"file":"static/js/365.c7fa91f8.chunk.js","mappings":"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","sources":["pages/CartPage.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Layout from \"./../components/Layout/Layout\";\r\nimport { useCart } from \"../context/cart\";\r\nimport { useAuth } from \"../context/auth\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport DropIn from \"braintree-web-drop-in-react\";\r\nimport { AiFillWarning } from \"react-icons/ai\";\r\nimport axios from \"axios\";\r\nimport toast from \"react-hot-toast\";\r\nimport \"../styles/CartStyles.css\";\r\n\r\nconst CartPage = () => {\r\n  const [auth, setAuth] = useAuth();\r\n  const [cart, setCart] = useCart();\r\n  const [clientToken, setClientToken] = useState(\"\");\r\n  const [instance, setInstance] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  //total price\r\n  const totalPrice = () => {\r\n    try {\r\n      let total = 0;\r\n      cart?.map((item) => {\r\n        <div key={item._id}>total = total + item.price;</div>\r\n      });\r\n      return total.toLocaleString(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n      });\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n  //detele item\r\n  const removeCartItem = (pid) => {\r\n    try {\r\n      let myCart = [...cart];\r\n      let index = myCart.findIndex((item) => item._id === pid);\r\n      myCart.splice(index, 1);\r\n      setCart(myCart);\r\n      localStorage.setItem(\"cart\", JSON.stringify(myCart));\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  //get payment gateway token\r\n  const getToken = async () => {\r\n    try {\r\n      const { data } = await axios.get(\"/api/v1/product/braintree/token\");\r\n      setClientToken(data?.clientToken);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    getToken();\r\n  }, [auth?.token]);\r\n\r\n  //handle payments\r\n  const handlePayment = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { nonce } = await instance.requestPaymentMethod();\r\n      const { data } = await axios.post(\"/api/v1/product/braintree/payment\", {\r\n        nonce,\r\n        cart,\r\n      });\r\n      setLoading(false);\r\n      localStorage.removeItem(\"cart\");\r\n      setCart([]);\r\n      navigate(\"/dashboard/user/orders\");\r\n      toast.success(\"Payment Completed Successfully \");\r\n    } catch (error) {\r\n      console.log(error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n  return (\r\n    <Layout title={\"Cart - Books \"}>\r\n      <div className=\" cart-page\">\r\n        <div className=\"row\">\r\n          <div className=\"col-md-12\">\r\n            <h1 className=\"text-center bg-light p-2 mb-1\">\r\n              {!auth?.user\r\n                ? \"Hello Guest\"\r\n                : `Hello  ${auth?.token && auth?.user?.name}`}\r\n              <p className=\"text-center\">\r\n                {cart?.length\r\n                  ? `You Have ${cart.length} items in your cart ${\r\n                      auth?.token ? \"\" : \"please login to checkout !\"\r\n                    }`\r\n                  : \" Your Cart Is Empty\"}\r\n              </p>\r\n            </h1>\r\n          </div>\r\n        </div>\r\n        <div className=\"container mt-3\">\r\n          <div className=\"row\">\r\n            <div className=\"col-md-6  p-0 m-0\">\r\n              {cart?.map((p) => (\r\n                <div className=\"row card flex-row\" key={p._id}>\r\n                  <div className=\"col-md-4\">\r\n                    <img\r\n                      src={`/api/v1/product/product-photo/${p._id}`}\r\n                      className=\"card-img-top\"\r\n                      alt={p.name}\r\n                      width=\"100%\"\r\n                      height={\"130px\"}\r\n                        loading=\"lazy\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"col-md-4\">\r\n                    <p>{p.name}</p>\r\n                    <p>{p.description.substring(0, 30)}</p>\r\n                    <p>Price : ${p.price}</p>\r\n                  </div>\r\n                  <div className=\"col-md-4 cart-remove-btn\">\r\n                    <button\r\n                      className=\"btn btn-danger\"\r\n                      onClick={() => removeCartItem(p._id)}\r\n                    >\r\n                      Remove\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            <div className=\"col-md-5 cart-summary ml-3\" style={{marginLeft:\"20px\"}}>\r\n              <h2>Cart Summary</h2>\r\n              <p>Total | Checkout | Payment</p>\r\n              <hr />\r\n              <h4>Total : {totalPrice()} </h4>\r\n              {auth?.user?.address ? (\r\n                <>\r\n                  <div className=\"mb-3\">\r\n                    <h4>Current Address</h4>\r\n                    <h5>{auth?.user?.address}</h5>\r\n                    <button\r\n                      className=\"btn btn-outline-warning\"\r\n                      onClick={() => navigate(\"/dashboard/user/profile\")}\r\n                    >\r\n                      Update Address\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <div className=\"mb-3\">\r\n                  {auth?.token ? (\r\n                    <button\r\n                      className=\"btn btn-outline-warning\"\r\n                      onClick={() => navigate(\"/dashboard/user/profile\")}\r\n                    >\r\n                      Update Address\r\n                    </button>\r\n                  ) : (\r\n                    <button\r\n                      className=\"btn btn-outline-warning\"\r\n                      onClick={() =>\r\n                        navigate(\"/login\", {\r\n                          state: \"/cart\",\r\n                        })\r\n                      }\r\n                    >\r\n                      Plase Login to checkout\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              )}\r\n              <div className=\"mt-2\">\r\n                {!clientToken || !auth?.token || !cart?.length ? (\r\n                  \"\"\r\n                ) : (\r\n                  <>\r\n                    <DropIn\r\n                      options={{\r\n                        authorization: clientToken,\r\n                        paypal: {\r\n                          flow: \"vault\",\r\n                        },\r\n                      }}\r\n                      onInstance={(instance) => setInstance(instance)}\r\n                    />\r\n\r\n                    <button\r\n                      className=\"btn btn-primary\"\r\n                      onClick={handlePayment}\r\n                      disabled={loading || !instance || !auth?.user?.address}\r\n                    >\r\n                      {loading ? \"Processing ....\" : \"Make Payment\"}\r\n                    </button>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default CartPage;\r\n"],"names":["useAuth","auth","useCart","cart","setCart","useState","clientToken","setClientToken","instance","setInstance","loading","setLoading","navigate","useNavigate","getToken","axios","data","console","log","useEffect","token","handlePayment","requestPaymentMethod","nonce","localStorage","removeItem","toast","Layout","title","className","user","name","length","map","p","src","_id","alt","width","height","description","substring","price","onClick","pid","myCart","index","findIndex","item","splice","setItem","JSON","stringify","error","removeCartItem","style","marginLeft","toLocaleString","currency","totalPrice","address","state","options","authorization","paypal","flow","onInstance","disabled"],"sourceRoot":""}